{"version":3,"sources":["./src/app/pages/game/game.component.ts","./src/app/pages/game/game.component.html","./src/app/core/store/video.service.ts","./src/app/core/store/chat.service.ts","./src/app/pages/game/game.module.ts","./src/app/pages/game/piece-selector-modal/piece-selector.modal.ts","./src/app/pages/game/piece-selector-modal/piece-selector.modal.html"],"names":[],"mappings":"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","file":"src-app-pages-game-game-module-es2015.js","sourcesContent":["import {Component, ElementRef, HostListener, OnDestroy, OnInit, ViewChild} from '@angular/core';\nimport {ActivatedRoute, Router} from \"@angular/router\";\nimport {EGameStatus, StoreService} from \"@core/store/store.service\";\nimport {JbProfileService} from \"@core/common/jb-profile.service\";\nimport {NgbModal} from \"@ng-bootstrap/ng-bootstrap\";\nimport {PieceSelectorModal} from \"./piece-selector-modal/piece-selector.modal\";\nimport {JbConfirmService} from \"jb-ui-lib\";\nimport {interval} from \"rxjs\";\nimport {distinctUntilChanged, map, take} from \"rxjs/operators\";\nimport {SubSink} from \"subsink\";\nimport {ChatService} from \"@core/store/chat.service\";\nimport {VideoService} from \"@core/store/video.service\";\n\n\n@Component({\n  selector: 'jb-game',\n  templateUrl: './game.component.html',\n  styleUrls: ['./game.component.scss']\n})\nexport class GameComponent implements OnInit, OnDestroy {\n  private subs = new SubSink();\n  public gameId;\n  public game;\n  public yourColor: 'WHITE' | 'BLACK';\n  public otherColor: 'WHITE' | 'BLACK';\n  public phase = 0; // 0=select piece, 1=select destination\n  public selPos;    // Position of the selected piece (to move)\n  public validMoves = []; // Valid destination nums for the selected piece\n  public reverseBoard = false;  // false=white at the bottom, true=black at the bottom\n  public mode = 'play'; // play=make next move,  analyse=play both (no commit)\n\n  public squares = Array.from({ length: 64 }, (x, i) => i);\n\n  tab = 'moves';\n  chatInput = '';\n\n  constructor(\n    public store: StoreService,\n    public chat: ChatService,\n    public profile: JbProfileService,\n    public router: Router,\n    private route: ActivatedRoute,\n    private modal: NgbModal,\n    private confirm: JbConfirmService,\n    public video: VideoService,\n  ) {\n  }\n\n  async ngOnInit() {\n    let firstLoad = true;\n    this.gameId = this.route.snapshot.paramMap.get('gameId');\n    const tokenId = this.route.snapshot.paramMap.get('tokenId');\n    console.log('GAME ID:', this.gameId, 'TOKEN ID:', tokenId);\n\n    if (!this.profile.user) {\n      if (!tokenId) { this.unknownPlayer() }\n      await this.profile.anonymousLogin(); // Generate anonymous user if none\n    }\n\n    await this.profile.ready;\n\n    // 1st game load\n    this.subs.add(this.store.getGame$(this.gameId).pipe(take(1)).subscribe(game => {\n      console.log('My profile ID:', this.profile.user.id);\n\n      // Determine who you are (player 1 or 2)\n      if (game.token1 === tokenId || game.player1 === this.profile.user.id) { this.yourColor = 'WHITE'; }\n      if (game.token2 === tokenId || game.player2 === this.profile.user.id) { this.yourColor = 'BLACK'; }\n      if (!this.yourColor) { this.unknownPlayer(); } // If this is not your game, get out\n      this.otherColor = this.yourColor === 'BLACK' ? 'WHITE' :'BLACK';\n      this.reverseBoard = this.yourColor === 'BLACK';\n\n      this.video.initSignaling(this.gameId, this.yourColor);\n      this.changeTab('video');\n    }));\n\n    // Subscribe to game's changes\n    this.subs.add(this.store.getGame$(this.gameId).subscribe(game => {\n      this.game = { ...game, id: this.gameId };\n\n      // Join the requested game\n      if (game.token2 === tokenId) {\n        if (game.status === EGameStatus.REQUESTED) { this.store.joinGame(this.game); }\n        if (game.player2 !== this.profile.user.id) { this.store.updateGamePlayer(this.game); }\n      }\n    }));\n\n    // Subscribe to game's status changes\n    this.subs.add(this.store.getGame$(this.gameId).pipe(\n      distinctUntilChanged((prev, curr) => prev.status === curr.status)\n    ).subscribe(game => {\n      console.log(new Date(), 'GAME STATUS CHANGE', this.game.status);\n      if (!firstLoad) { this.checkEndState(game); } // Check if check mate (opponent's won)\n      firstLoad = false;\n    }));\n\n    this.subs.add(this.video.tabChange$.subscribe(tab => this.changeTab(tab)));\n\n    this.onResize();\n\n    // Constantly check the move timeout. TODO: Move this to a cloud function\n    this.subs.add(interval(1000).subscribe(_ => {\n      if (this.getRemainingTime() < 0) {\n        if (this.game.status === EGameStatus.WHITE) {\n          this.game.status = EGameStatus.BLACK_WON_BY_TIMEOUT;\n          this.store.updateGame(this.game);\n        }\n        if (this.game.status === EGameStatus.BLACK) {\n          this.game.status = EGameStatus.WHITE_WON_BY_TIMEOUT;\n          this.store.updateGame(this.game);\n        }\n      }\n    }));\n  }\n\n  ngOnDestroy() { this.subs.unsubscribe(); this.video.endSignaling(); }\n\n  public boardSize = 500;\n  public minRightPanelWidth = 500;\n  public isSmall = false;\n  @ViewChild('panel', { static: true }) panel: ElementRef<HTMLElement>;\n\n  @HostListener('window:resize', ['$event']) onResize() {\n    const width = this.panel.nativeElement.getBoundingClientRect().width;\n    const height = this.panel.nativeElement.getBoundingClientRect().height;\n    this.isSmall = width < 1000;  // Small screen mode\n    if (this.isSmall) {\n      this.boardSize = Math.round(Math.min(width, height));\n    } else {\n      this.boardSize = Math.round(Math.min(width - this.minRightPanelWidth, height));\n    }\n  }\n\n  unknownPlayer() {\n    this.confirm.open({\n      title         : 'view.game.unknown_player',\n      text          : 'view.game.unknown_player',\n      yesButtonText : 'view.common.ok',\n      showNo        : false,\n    }).then(() => {\n      this.router.navigate(['home']);\n    });\n  }\n\n  isAdmin = () => this.yourColor === 'WHITE';\n  isGameOn = () => this.game?.status === EGameStatus.WHITE || this.game?.status === EGameStatus.BLACK;\n\n  finishGame() {\n    this.confirm.open({\n      title         : 'view.game.finish_tooltip',\n      text          : 'view.game.finish_confirmation',\n      showCancel: false,\n      showNo: true,\n    }).then(res => {\n      if (res === 'yes') { this.store.endGame(this.game, this.profile.user.id); }\n    }, () => {});\n  }\n\n  getStatusText() {\n    if (this.game?.status === EGameStatus.REQUESTED) { return 'Awaiting player to join the game'; }\n    if (this.game?.status === EGameStatus.WHITE) {\n      if (this.yourColor === 'WHITE') { return 'You (white) play'; }\n      if (this.yourColor === 'BLACK') { return 'White plays (wait for it)'; }\n    }\n    if (this.game?.status === EGameStatus.BLACK) {\n      if (this.yourColor === 'WHITE') { return 'Black plays (wait for it)'; }\n      if (this.yourColor === 'BLACK') { return 'You (black) play' }\n    }\n    if (this.game?.status === EGameStatus.DRAW) { return 'Game finished, ended in Draw'; }\n    if (this.game?.status === EGameStatus.WHITE_WON_BY_MATE)    { return 'Game finished, white won by mate'; }\n    if (this.game?.status === EGameStatus.WHITE_WON_BY_TIMEOUT) { return 'Game finished, white won by timeout'; }\n    if (this.game?.status === EGameStatus.WHITE_WON_BY_RESIGN)  { return 'Game finished, white won by resignation'; }\n    if (this.game?.status === EGameStatus.BLACK_WON_BY_MATE)    { return 'Game finished, black won by mate'; }\n    if (this.game?.status === EGameStatus.BLACK_WON_BY_TIMEOUT) { return 'Game finished, black won by timeout'; }\n    if (this.game?.status === EGameStatus.BLACK_WON_BY_RESIGN)  { return 'Game finished, black won by resignation'; }\n    return '';\n  }\n\n\n\n  // White player (reverseBoard=false) --> pos = pos\n  // Black player (reverseBoard=true) ---> pos = 64 - pos\n  public getPos = (pos) => !this.reverseBoard ? pos : 63 - pos;\n\n\n  // Returns an array of the taken pieces of the given color\n  public getTakenPieces = (color) => {\n    return this.game.history.filter(m => m.takes).map(m => this.store.getPiece(m.takes)).filter(p => p.color === color);\n  };\n\n\n  // Returns the points ahead for the winning player (if <= 0 an empty string is displayed)\n  public getPoints = (color) => {\n    const calcPoints = (color) => {\n      return this.getTakenPieces(color).reduce((acc, piece) => {\n        if (piece.name === 'pawn')   { return acc + 1; }\n        if (piece.name === 'knight') { return acc + 3; }\n        if (piece.name === 'bishop') { return acc + 3; }\n        if (piece.name === 'rook')   { return acc + 5; }\n        if (piece.name === 'queen')  { return acc + 9; }\n        return 0;\n      }, 0);\n    };\n    let points = calcPoints(color === 'WHITE' ? 'BLACK': 'WHITE') - calcPoints(color);\n    if (points > 0) { return '+' + points; }\n    return '';\n  };\n\n\n  // Calculate the remaining times for the players moves\n  public wTime$ = interval(200).pipe(map(_ => this.getFormattedTime('WHITE')));\n  public bTime$ = interval(200).pipe(map(_ => this.getFormattedTime('BLACK')));\n  public getRemainingTime = () => {\n    if (this.game) {\n      let expireTime = new Date(this.game.history.getLast()?.timeStamp || this.game.startTime);\n      expireTime.addMinutes(30000); // <--- TIME FOR THE NEXT MOVE\n      const now = new Date();\n      return Math.round((expireTime.getTime() - now.getTime()) / 1000);\n    } else {\n      return 1;\n    }\n  }\n  public getFormattedTime = (color) => {\n    if (this.game.status === EGameStatus.BLACK_WON_BY_TIMEOUT && color === 'WHITE') { return 'Timeout'; }\n    if (this.game.status === EGameStatus.WHITE_WON_BY_TIMEOUT && color === 'BLACK') { return 'Timeout'; }\n    const time = this.getRemainingTime();\n    if (this.game.status !== color) { return '--:--:--'; }  // If not your turn, or draw.\n    const sec = time % 60;\n    const min = Math.floor((time - sec) / 60) % 60;\n    const hour = Math.floor((time - min - sec) / 3600);\n    // const day = Math.floor((time - hour - min - sec) / 86400);\n    return `${hour.pad(2)}:${min.pad(2)}:${sec.pad(2)}`;\n  }\n\n\n\n\n  public resetGame = () => {\n    this.store.resetGame(this.game);\n    this.store.updateGame(this.game);\n  }\n\n  public revertLast = () => {\n    this.game.history.pop();\n    const lastMove = this.game.history.getLast();\n    if (lastMove) {\n      this.game.board = [...lastMove.nextBoard];\n      this.game.status = this.game.status === EGameStatus.WHITE ? EGameStatus.BLACK : EGameStatus.WHITE;\n    } else {\n      this.store.resetGame(this.game);\n    }\n    this.store.updateGame(this.game).then(() => this.clearPhase());\n  }\n\n  private clearPhase = () => {\n    this.selPos = null;\n    this.validMoves = [];\n    this.phase = 0;\n  }\n  private selectPiece = (pos) => {\n    this.selPos = pos;\n    this.validMoves = this.store.getValidMoves(this.game, pos).map(m => m.posDes);\n    this.phase = 1;\n  };\n\n  public selectSquare = (pos) => {\n    if (this.yourColor !== this.game.status) { return console.log('NOT YOUR TURN, PLEASE WAIT'); }\n\n    if (this.phase === 0) { // Select a piece to move\n      if (this.isYourPiece(pos)) { this.selectPiece(pos); }\n\n    } else {  // Select destination\n      if (this.selPos === pos) { return this.clearPhase(); }  // unselect the same piece\n\n      const pieceAtPos = this.store.getPiece(this.game.board[pos]);\n      if (pieceAtPos.color === this.yourColor) { this.selectPiece(pos); } // Selecting another of your pieces (switch selection)\n      if (pieceAtPos.color !== this.yourColor) {\n\n        const oriPiece = this.store.getPiece(this.game.board[this.selPos]); // Moving pawn\n        if (this.store.isPawnFinished(this.selPos, pos, oriPiece)) { // Select a promoted piece for a pawn\n          const modalRef = this.modal.open(PieceSelectorModal, { size: 'md', backdrop: 'static' });\n          modalRef.componentInstance.color = this.yourColor;\n          modalRef.result.then(code => this.commitMove(this.game, this.selPos, pos, code)).finally(() => this.clearPhase());\n\n        } else { // Make the move\n          this.commitMove(this.game, this.selPos, pos).then(() => this.clearPhase());\n        }\n      }\n    }\n  };\n\n  public isSelectable = (pos) => {\n    if (this.yourColor !== this.game?.status) { return false; }\n    if (this.phase === 0) { return this.isYourPiece(pos); } // Select piece\n    if (this.phase === 1) { return this.isYourPiece(pos) || this.validMoves.includes(pos); } // Select destination\n  };\n\n  public isYourPiece = (pos) => {\n    if (this.game.board[pos] === 0) { return false; }\n    const piece = this.store.getPiece(this.game.board[pos]);\n    return piece.color === this.yourColor;\n  }\n\n  public commitMove(game, posOri, posDes, promotedPieceCode?) {\n    this.store.makeMove(game, posOri, posDes, promotedPieceCode);\n    this.checkEndState(game);\n    return this.store.updateGame(game);\n  }\n\n\n  // Check if the game is finished, and prompt the (win / lose) popup to notify it\n  public checkEndState = (game) => {\n    let winner, title, htmlContent;\n    switch (game.status) {\n      case EGameStatus.WHITE_WON_BY_MATE:     winner = 'WHITE'; title = 'view.game.check_mate'; break;\n      case EGameStatus.WHITE_WON_BY_TIMEOUT:  winner = 'WHITE'; title = 'view.game.win_by_timeout'; break;\n      case EGameStatus.WHITE_WON_BY_RESIGN:   winner = 'WHITE'; title = 'view.game.win_by_resign'; break;\n      case EGameStatus.BLACK_WON_BY_MATE:     winner = 'BLACK'; title = 'view.game.check_mate'; break;\n      case EGameStatus.BLACK_WON_BY_TIMEOUT:  winner = 'BLACK'; title = 'view.game.win_by_timeout'; break;\n      case EGameStatus.BLACK_WON_BY_RESIGN:   winner = 'BLACK'; title = 'view.game.win_by_resign'; break;\n      default: break;\n    }\n\n    if (this.yourColor === winner) {\n      htmlContent = '<h4 class=\"text-center\">Congratulations, you won!</h4>';\n      this.confirm.open({ title, htmlContent, yesButtonText: 'view.common.ok', showNo: false, showCancel: false });\n    }\n    if (this.otherColor === winner) {\n      htmlContent = '<h4 class=\"text-center\">Sorry, you lost.</h4>';\n      this.confirm.open({ title, htmlContent, yesButtonText: 'view.common.ok', showNo: false, showCancel: false });\n    }\n  }\n\n\n  changeTab(newTab = 'moves') {\n    this.tab = newTab;\n    if (this.tab === 'video' && !this.video.localStream) { this.video.initMedia(); }\n  }\n\n  /// ------------ CHAT -------------\n  sendMsg() {\n    this.chat.sendMsg(this.game, this.chatInput, this.yourColor);\n    this.chatInput = '';\n  }\n\n  canAnswerCall() {\n    return (this.video.playerNum === 1 && this.video.videoStatus === 'A<-B')\n        || (this.video.playerNum === 2 && this.video.videoStatus === 'A->B');\n  }\n\n  getVideoStatusClass() {\n    if (!this.video.videoStatus) { return 'off'; }\n    if (this.video.videoStatus === 'A==B') { return 'connected'; }\n    return 'connecting';\n  }\n}\n","<div class=\"panel\" [class.is-small]=\"isSmall\" #panel>\n  <div class=\"left-side\">\n\n    <div class=\"marks-h\" [show]=\"!reverseBoard\"><i>a</i><i>b</i><i>c</i><i>d</i><i>e</i><i>f</i><i>g</i><i>h</i></div>\n    <div class=\"marks-h\" [show]=\"reverseBoard\"> <i>h</i><i>g</i><i>f</i><i>e</i><i>d</i><i>c</i><i>b</i><i>a</i></div>\n    <div class=\"marks-v\" [style.height.px]=\"boardSize\" [show]=\"!reverseBoard\"><i>8</i><i>7</i><i>6</i><i>5</i><i>4</i><i>3</i><i>2</i><i>1</i></div>\n    <div class=\"marks-v\" [style.height.px]=\"boardSize\" [show]=\"reverseBoard\"> <i>1</i><i>2</i><i>3</i><i>4</i><i>5</i><i>6</i><i>7</i><i>8</i></div>\n\n    <div class=\"board\" *ngIf=\"game\" [style.width.px]=\"boardSize\" [style.height.px]=\"boardSize\">\n      <div class=\"square\" *ngFor=\"let pos of squares\" [ngClass]=\"store.squareColor(pos)\">\n        <!--{{getPos(pos)}} - {{store.square2D(pos) | json}}={{store.getPiece(game.board[pos]) | json }}-->\n        <!--{{getPos(pos)}}-->\n        <div class=\"selector\"\n             [class.is-selectable]=\"isSelectable(getPos(pos))\"\n             [class.selected]=\"selPos === getPos(pos)\"\n             (click)=\"selectSquare(getPos(pos))\">\n          <span *ngIf=\"phase === 1 && validMoves.includes(getPos(pos))\"\n                class=\"move-mark\" [class.has-piece]=\"game.board[getPos(pos)] > 0\">\n          </span>\n          <img *ngIf=\"game.board[getPos(pos)] > 0\" [src]=\"store.getPiece(game.board[getPos(pos)]).img\">\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"right-side\">\n    <div class=\"game-info\">\n      <div class=\"admin-buttons-row marB15\" *ngIf=\"isAdmin()\">\n        <jb-btn jbText=\"RESET\" jbType=\"add\" (jbClick)=\"resetGame()\"></jb-btn>\n        <jb-btn jbText=\"UNDO\" jbType=\"back\" (jbClick)=\"revertLast()\"></jb-btn>\n      </div>\n      <div class=\"buttons-row\">\n        <jb-btn jbTooltip=\"view.game.turn\" jbIcon=\"icon-loop\" (jbClick)=\"reverseBoard = !reverseBoard\"></jb-btn>\n        <jb-btn *ngIf=\"isAdmin()\" jbTooltip=\"view.game.analyse\" jbIcon=\"icon-pencil5\" (jbClick)=\"mode = 'analyse'\"></jb-btn>\n        <jb-btn *ngIf=\"isAdmin()\" jbTooltip=\"view.game.prev_move\" jbIcon=\"icon-arrow-left6\"></jb-btn>\n        <jb-btn *ngIf=\"isAdmin()\" jbTooltip=\"view.game.next_move\" jbIcon=\"icon-arrow-right3\"></jb-btn>\n        <jb-btn *ngIf=\"isAdmin()\" jbTooltip=\"view.game.reset\" jbIcon=\"icon-flag7\"></jb-btn>\n        <jb-btn *ngIf=\"isGameOn()\" jbTooltip=\"view.game.finish_tooltip\" jbIcon=\"icon-finish\" (jbClick)=\"finishGame()\"></jb-btn>\n        <jb-btn *ngIf=\"isAdmin()\"\n                class=\"back-btn quaternary marL20\" jbTooltip=\"view.game.back_tooltip\"\n                jbIcon=\"icon-undo2\" jbText=\"view.common.back\"\n                (jbClick)=\"router.navigate(['/games'])\">\n        </jb-btn>\n      </div>\n\n      <div class=\"marT30\" *ngIf=\"game\">\n        <div class=\"d-flex\">\n          <h2 class=\"flex-1 text-center\">{{game.playerName1}}</h2>\n          <h2 class=\"flex-1 text-center\">{{game.playerName2}}</h2>\n        </div>\n        <div class=\"d-flex\">\n          <h4 class=\"flex-1 text-center\">(WHITE)</h4>\n          <h4 class=\"flex-1 text-center\">(BLACK)</h4>\n        </div>\n        <div class=\"d-flex game-points\">\n          <h4 class=\"flex-1 text-center\">{{ wTime$ | async }}</h4>\n          <h4 class=\"flex-1 text-center\">{{ bTime$ | async }}</h4>\n        </div>\n        <div class=\"d-flex game-points marB10\">\n          <span class=\"flex-1 text-center\">{{ getPoints('WHITE') }}</span>\n          <span class=\"flex-1 text-center\">{{ getPoints('BLACK') }}</span>\n        </div>\n        <div class=\"d-flex\">\n          <div class=\"taken-pieces\">\n            <img *ngFor=\"let piece of getTakenPieces('BLACK')\" [src]=\"piece?.img\">\n          </div>\n          <div class=\"taken-pieces\">\n            <img *ngFor=\"let piece of getTakenPieces('WHITE')\" [src]=\"piece?.img\">\n          </div>\n        </div>\n        <!--<p *ngIf=\"game?.status === yourColor\">{{game.playerName1}} ({{yourColor}}) play</p>-->\n      </div>\n    </div>\n\n\n\n    <div class=\"tab-headers\" *ngIf=\"game\">\n      <div class=\"tab-header\" [class.selected]=\"tab === 'moves'\" (click)=\"changeTab('moves')\" translate>views.game.tabs.moves</div>\n      <div class=\"tab-header\" [class.selected]=\"tab === 'chat'\"  (click)=\"changeTab('chat')\"  translate>views.game.tabs.chat</div>\n      <div class=\"tab-header\" [class.selected]=\"tab === 'video'\" (click)=\"changeTab('video')\" translate>views.game.tabs.video</div>\n    </div>\n    <div class=\"tab-body\" *ngIf=\"game\" [class.video]=\"tab === 'video'\" [class]=\"getVideoStatusClass()\">\n      <div *ngIf=\"tab === 'moves'\">\n        <div *ngIf=\"game?.history\" style=\"font-family: monospace\">\n          <div *ngFor=\"let move of game.history.slice().reverse(); let ind = index\">\n            {{game.history.length - ind}} - {{ move.note }} - posOri={{move.posOri}}, posDes={{move.posDes}}\n            <span> - ({{move.piece.color}})</span>\n            <span *ngIf=\"move.takes\">, TAKES={{move.takes}}</span>\n          </div>\n        </div>\n      </div>\n\n      <div *ngIf=\"tab === 'chat'\">\n        <div *ngIf=\"game?.chat\">\n          <p *ngFor=\"let msg of game.chat\">\n            <span>{{msg.owner === yourColor ? '(me): ' : '(' + (yourColor === 'WHITE' ? game.playerName2 : game.playerName1) + '): ' }}</span>\n            <span>{{msg.text}}</span>\n          </p>\n        </div>\n      </div>\n      <div *ngIf=\"tab === 'video'\">\n        <div class=\"video-buttons\">\n          <jb-btn *ngIf=\"video.videoStatus !== ''\" jbText=\"Hang Up\" (jbClick)=\"video.hangup()\"></jb-btn>\n          <jb-btn *ngIf=\"video.videoStatus === ''\" jbText=\"Make Call\" (jbClick)=\"video.makeCall()\"></jb-btn>\n          <jb-btn *ngIf=\"canAnswerCall()\" jbText=\"Answer Call\" (jbClick)=\"video.answerCall()\"></jb-btn>\n          <jb-label class=\"padL15 value-inline\" jbText=\"Status\" [jbValue]=\"video.statusText\"></jb-label>\n        </div>\n        <video class=\"local-video\"  playsinline autoplay muted [srcObject]=\"video.localStream\"></video>\n        <video class=\"remote-video\" playsinline autoplay       [srcObject]=\"video.remoteStream\"></video>\n      </div>\n    </div>\n    <div class=\"tab-footer\">\n      <div class=\"chat-input-row\" *ngIf=\"tab === 'chat'\">\n        <jb-input class=\"flat w-100 padR10\" [jbAutoFocus]=\"true\" [(ngModel)]=\"chatInput\" (jbOnEnter)=\"sendMsg()\"></jb-input>\n        <jb-btn jbType=\"update-icon\" (jbClick)=\"sendMsg()\"></jb-btn>\n      </div>\n      <div class=\"marH5\">{{getStatusText()}}</div>\n    </div>\n\n\n  </div>\n</div>\n\n\n","import {Injectable} from \"@angular/core\";\nimport {IGameDoc, StoreService} from \"@core/store/store.service\";\nimport {JbProfileService} from \"@core/common/jb-profile.service\";\nimport {AngularFireAuth} from \"@angular/fire/auth\";\nimport {AngularFirestore} from \"@angular/fire/firestore\";\nimport {distinctUntilChanged, pluck} from \"rxjs/operators\";\nimport {JbConfirmService, JbGrowlService} from \"jb-ui-lib\";\nimport {BehaviorSubject} from \"rxjs\";\n\n/*** Player 1 calls player 2:\n - Both are idle: video.status = '';\n - Player 1 makes a call changing the ----> video.status = 'A-> ';\n - Player 2 detects that 1 is calling, and starts ringing. It changes the ----> video.status = 'A->B';\n - Player 2 answers the call, changing the ----> video.status = 'A>>B'.\n - ICE Candidate gathering process happens for Player 1\n - Player 1 detects that and the WebRTC process starts -----> video.offerSDP = 'xxxx'\n - ICE Candidate gathering process happens for Player 2\n - Player 2 detects the offer SDP, and generates answer ----> video.answerSDP = 'xxxx'\n - Once the WebRTC is ready (ontrack) the remote stream is displayed on the html.\n Player 1 detects it and updates the status ----> video.status = 'A==B';\n - Player 1 stops the call updating ----> video.status = '    ';\n - Player 2 detects it and stops the call too.\n */\n\n/*** Player 1 calls, but player 2 rejects:\n - Both are idle: video.status = '';\n - Player 1 makes a call changing the ----> video.status = 'A-> ';\n - Player 2 detects that 1 is calling, and starts ringing. It changes the ----> video.status = 'A->B';\n - Player 2 rejects the call, changing the ----> video.status = '    '.\n - Player 1 detects that and stops the call\n */\n\n\n@Injectable({ providedIn: 'root', })\nexport class VideoService {\n  sub1; sub2; sub3;\n  CONSTRAINTS = {\n    audio: true,\n    video: true,\n  };\n  PEER_CONFIG = { iceServers: [\n    { urls: 'stun:stun.l.google.com:19302'  },\n    { urls: 'stun:stun1.1.google.com:19302' },\n    { urls: 'stun:stun2.1.google.com:19302' },\n  ]};\n  OFFER_OPTIONS = {\n    iceRestart: true,\n    offerToReceiveAudio: true,\n    offerToReceiveVideo: true,\n  };\n  RTCPeerConnection = window['RTCPeerConnection'] || window['mozRTCPeerConnection'] || window['webkitRTCPeerConnection'];\n\n  peer;          // local peer connection\n  localStream;\n  remoteStream;\n\n  statusText = 'Off';\n  videoStatus = ''; /***\n    ''     No call\n    'A-> ' A calling B              ' <-B' B calling A\n    'A->B' A calling B (Ringing)    'A<-B' B calling A (Ringing)\n    'A>>B' WebRTC connecting        'A<<B' WebRTC connecting\n    'A==B' Connected   */\n\n\n  gameDoc;        // Reference to the\n  playerNum: number;  // 1=White(A), 2=Black(B)\n\n  myICECandidates = [];\n  sdpPromiseResolve;\n  sdpPromise = new Promise(resolve => this.sdpPromiseResolve = resolve);\n\n  tabChange$ = new BehaviorSubject('moves'); // To force the UI to change the video tab\n\n  constructor(\n    private profile: JbProfileService,\n    private store: StoreService,\n    private afAuth: AngularFireAuth,\n    private afs: AngularFirestore,\n    private growl: JbGrowlService,\n    private confirm: JbConfirmService,\n  ) {}\n\n  initSignaling(gameId, yourColor) {\n    this.playerNum = yourColor === 'WHITE' ? 1 : 2;\n    this.gameDoc = this.afs.doc<IGameDoc>('games/' + gameId);\n    const game$ = this.store.getGame$(gameId);\n\n    if (!this.sub1) { this.sub1 = game$.pipe(pluck('videoStatus'), distinctUntilChanged()).subscribe(video => this.videoStatusChange(video)); }\n    if (!this.sub2) { this.sub2 = game$.pipe(pluck('offerSDP'), distinctUntilChanged()).subscribe(offer => this.offerChanged(offer)); }\n    if (!this.sub3) { this.sub3 = game$.pipe(pluck('answerSDP'), distinctUntilChanged()).subscribe(answer => this.answerChanged(answer)); }\n  }\n\n\n  endSignaling() {\n    if (this.sub1) { this.sub1.unsubscribe(); }\n    if (this.sub2) { this.sub2.unsubscribe(); }\n    if (this.sub3) { this.sub3.unsubscribe(); }\n  }\n\n  async offerChanged(offerSDP) {\n    if (offerSDP) {\n      if (this.playerNum === 1 && this.videoStatus === 'A<<B') { await this.answerOffer(offerSDP); } // WebRTC: Player 2 is sending the offer, answer it\n      if (this.playerNum === 2 && this.videoStatus === 'A>>B') { await this.answerOffer(offerSDP); } // WebRTC: Player 1 is sending the offer, answer it\n    }\n  }\n  async answerChanged(answerSDP) {\n    if (answerSDP) {\n      if (this.playerNum === 1 && this.videoStatus === 'A>>B') { await this.acknowledgeAnswer(answerSDP); } // WebRTC: Player 2 answered the offer. Acknowledge it\n      if (this.playerNum === 2 && this.videoStatus === 'A<<B') { await this.acknowledgeAnswer(answerSDP); } // WebRTC: Player 1 answered the offer. Acknowledge it\n    }\n  }\n\n  connexionTimeout;\n  async videoStatusChange(status) {\n    const prevStatus = this.videoStatus;\n    if (prevStatus !== status) { console.log(new Date(), `VIDEO status ${prevStatus} ===> '${status}'`); }\n    this.statusText = status;\n\n    // Player 1 --- calling ---> Player 2\n    if (this.playerNum === 1) {\n      if (status === 'A-> ') { this.statusText += ' - You are making a call'; }\n      if (status === 'A->B') { this.statusText += ' - The other end is RINGING'; }\n      if (status === 'A>>B' && prevStatus === 'A->B') { await this.startOffer(); } // Signaling: Player 2 wants to join the call. Start WebRTC offer\n    }\n    if (this.playerNum === 2) {\n      if (status === 'A-> ') { this.updateStatus('A->B'); this.statusText += ' - New Incoming Call'; } // Start ringing\n      if (status === 'A->B') { this.statusText += ' - RING RING! You are receiving a call. Want to answer?'; this.showRingAlert(); }\n    }\n\n    // Player 2 --- calling ---> Player 1\n    if (this.playerNum === 2) {\n      if (status === ' <-B') { this.statusText += ' - You are making a call'; }\n      if (status === 'A<-B') { this.statusText += ' - The other end is RINGING'; }\n      if (status === 'A<<B' && prevStatus === 'A<-B') { await this.startOffer(); }  // Signaling: Player 1 wants to join the call. Start WebRTC offer\n    }\n    if (this.playerNum === 1) {\n      if (status === ' <-B') { this.updateStatus('A<-B'); this.statusText += ' - New Incoming Call'; } // Start ringing\n      if (status === 'A<-B') { this.statusText += ' - RING RING! You are receiving a call. Want to answer?'; this.showRingAlert(); }\n    }\n\n    // Init the timeout when starting the webrtc connection\n    if ((prevStatus === 'A->B' && status === 'A>>B') || (prevStatus === 'A<-B' && status === 'A<<B')) {\n      this.connexionTimeout = setInterval(() => {\n        this.growl.error('Something went wrong, please try again later');\n        this.hangup();\n      }, 10*1000);\n    }\n\n    if (status === 'A>>B') { this.statusText += ' - Connecting...'; }\n    if (status === 'A<<B') { this.statusText += ' - Connecting...'; }\n    if (status === 'A==B') {\n      this.statusText += ' - On Call';\n      if (this.connexionTimeout) { clearInterval(this.connexionTimeout); }\n    }\n\n    if (status === '') { this.statusText += 'Off'; }\n    if (prevStatus !== '' && status === '') {\n      this.statusText += ' - The call has been terminated';\n      this.terminate();\n    }\n    this.videoStatus = status;\n  }\n\n  makeCall() {\n    if (this.videoStatus !== '') { this.growl.error(`There is another ongoing call ${this.videoStatus}`); return }\n    this.gameDoc.update({ videoStatus: (this.playerNum === 1 ? 'A-> ' : ' <-B'), offerSDP: null, answerSDP: null });\n  }\n\n  showRingAlert() {\n    this.confirm.open({\n      title: 'Incoming Call',\n      text: 'Your opponent is sending you a video call. Do you want to answer it?',\n      yesButtonText: 'Yes, answer the call',\n      noButtonText: 'No, reject it',\n      showNo: true,\n    }).then(res => {\n      if (res === 'yes') { this.answerCall(); this.tabChange$.next('video'); }\n      if (res === 'no')  { this.hangup(); }\n    });\n  }\n\n  answerCall() {\n    if (this.videoStatus === 'A<-B' && this.playerNum === 1) { this.updateStatus('A<<B'); }\n    if (this.videoStatus === 'A->B' && this.playerNum === 2) { this.updateStatus('A>>B'); }\n  }\n\n  hangup() {\n    // if (this.videoStatus === '') { console.warn('No call to hang up'); return }\n    this.terminate();\n    this.myICECandidates = [];\n    return this.gameDoc.update({ videoStatus: '', offerSDP: null, answerSDP: null });\n  }\n\n  private updateStatus(status) {\n    return this.gameDoc.update({ videoStatus: status });\n  }\n\n  // ------------------ WebRTC -------------------\n\n  async initMedia() {\n    try {\n      this.localStream = await navigator.mediaDevices.getUserMedia(this.CONSTRAINTS);\n      const tracks = {\n        video: this.localStream.getVideoTracks(),\n        audio: this.localStream.getAudioTracks(),\n      };\n      if (tracks.video.length) { console.log('Using video', tracks.video[0].label); }\n      if (tracks.audio.length) { console.log('Using audio', tracks.audio[0].label); }\n\n    } catch (err) { console.error('Video - initMedia() error', err); }\n  }\n\n  private initPeer() {\n    if (!this.localStream) { this.growl.error('There is a problem with your Camera / Microphone'); }\n    this.peer = new this.RTCPeerConnection(this.PEER_CONFIG);\n    this.remoteStream = new MediaStream();\n    this.peer.onicecandidate = ev => this.gatherICECandidate(ev);\n    this.peer.oniceconnectionstatechange = ev => this.ICEConnectionChange(ev);\n    this.peer.ontrack = async (ev) => ev.streams[0].getTracks().forEach(track => this.remoteStream.addTrack(track));\n    this.localStream.getTracks().forEach(track => this.peer.addTrack(track, this.localStream));\n    this.sdpPromise = new Promise(resolve => this.sdpPromiseResolve = resolve);\n  }\n\n  private async startOffer() { // WebRTC offer\n    try {\n      if (!this.localStream) { await this.initMedia(); }\n      if (!this.peer) { this.initPeer(); }\n      const offer = await this.peer.createOffer(this.OFFER_OPTIONS);\n      await this.peer.setLocalDescription(offer); // <-- after this, ICE candidate gathering starts\n      console.log('----------- startOffer - setLocalDescription');\n    } catch (err) { console.error('Video - startOffer() error', err); }\n  }\n\n  private async answerOffer(offerSDP) {  // WebRTC answer (handleOffer)\n    try {\n      if (!this.localStream) { await this.initMedia(); }\n      this.initPeer();\n      await this.peer.setRemoteDescription({ type: 'offer', sdp: offerSDP });\n      console.log('----------- answerOffer - setRemoteDescription');\n      const answer = await this.peer.createAnswer();\n      await this.peer.setLocalDescription(answer);\n      console.log('----------- answerOffer - setLocalDescription');\n    } catch (err) { console.error('Video - answerOffer() error', err); }\n  }\n\n\n  private async acknowledgeAnswer(answerSDP) { // WebRTC offer response (handleAnswer)\n    try {\n      if (!this.peer) { console.error('no peerconnection'); return; }\n      await this.peer.setRemoteDescription({ type: 'answer', sdp: answerSDP });\n      console.log('----------- answerOffer - setRemoteDescription');\n      this.sdpPromiseResolve();\n    } catch (err) { console.error('Video - acknowledgeAnswer() error', err); }\n  }\n\n\n  private gatherICECandidate(ev) {\n    const newICE: any = {\n      type: 'candidate',\n      candidate: null,\n    };\n    if (ev.candidate) {\n      newICE.candidate = ev.candidate.candidate;\n      newICE.sdpMid = ev.candidate.sdpMid;\n      newICE.sdpMLineIndex = ev.candidate.sdpMLineIndex;\n    }\n    console.log(new Date(), 'PLAYER', this.playerNum, ' HAS DISCOVER A NEW CANDIDATE!!!!');\n    this.myICECandidates.push(newICE);\n\n    console.log('RTCPeerConnection.iceConnectionState = ', this.peer.iceConnectionState);\n    if (this.peer.iceGatheringState === 'complete') {\n      console.log('ICE GATHERING COMPLETE!! sending SDP to the remote');\n      if (this.videoStatus === 'A>>B') {\n        if (this.playerNum === 1) { this.gameDoc.update({ offerSDP: this.peer.localDescription.sdp }); }\n        if (this.playerNum === 2) { this.gameDoc.update({ answerSDP: this.peer.localDescription.sdp }); this.sdpPromiseResolve(); }\n      }\n      if (this.videoStatus === 'A<<B') {\n        if (this.playerNum === 2) { this.gameDoc.update({ offerSDP: this.peer.localDescription.sdp }); }\n        if (this.playerNum === 1) { this.gameDoc.update({ answerSDP: this.peer.localDescription.sdp }); this.sdpPromiseResolve(); }\n      }\n    }\n  }\n\n  private ICEConnectionChange(ev) { // iceConnectionState: new -> checking -> connected\n    console.log('RTCPeerConnection.iceConnectionState = ', this.peer.iceConnectionState);\n    if (this.peer.iceConnectionState === 'connected') {\n      this.sdpPromise.then(() => {\n        console.log('WebRTC Connected !');\n        this.updateStatus('A==B');\n        this.tabChange$.next('video');\n      });\n    }\n  }\n\n  private terminate() {\n    if (this.peer) {\n      this.peer.close();\n      this.peer = null;\n    }\n    if (this.localStream) {\n      this.localStream.getTracks().forEach(track => track.stop());\n      this.localStream = null;\n    }\n    if (this.remoteStream) {\n      this.remoteStream.getTracks().forEach(track => track.stop());\n      this.remoteStream = null;\n    }\n\n    this.sdpPromise = new Promise(resolve => this.sdpPromiseResolve = resolve);\n    if (this.connexionTimeout) { clearInterval(this.connexionTimeout); }\n  };\n\n\n}\n","import {Injectable} from \"@angular/core\";\nimport {AngularFirestore, AngularFirestoreCollection} from \"@angular/fire/firestore\";\nimport {IGameDoc} from \"@core/store/store.service\";\nimport {Observable} from \"rxjs\";\nimport {JbProfileService} from \"@core/common/jb-profile.service\";\nimport {AngularFireAuth} from \"@angular/fire/auth\";\n\n\n@Injectable({ providedIn: 'root', })\nexport class ChatService {\n  public gamesCol: AngularFirestoreCollection<IGameDoc>;\n  public games$: Observable<IGameDoc[]>;\n\n  constructor(\n    private profile: JbProfileService,\n    private afAuth: AngularFireAuth,\n    private afs: AngularFirestore,\n  ) {\n  }\n\n  sendMsg(game, text, owner) {\n    const gameDoc = this.afs.doc<IGameDoc>('games/' + game.id);\n    game.chat.push({\n      order: game.chat.length + 1,\n      timeMsg: new Date() + '',\n      text,\n      owner,\n    });\n    console.log('game.chat', game.chat);\n    return gameDoc.update({ chat: game.chat });\n  }\n\n}\n","import {NgModule} from '@angular/core';\nimport {GameComponent} from \"./game.component\";\nimport {RouterModule, Routes} from \"@angular/router\";\nimport {PieceSelectorModal} from \"./piece-selector-modal/piece-selector.modal\";\nimport {CoreModule} from \"@core/core.module\";\n\n\nconst routes: Routes = [\n  { path: '', component: GameComponent },\n  { path: ':gameId', data: { noLogin: true },\n    children: [{ path: ':tokenId', data: { noLogin: true }, component: GameComponent }]\n  }\n];\n\n@NgModule({\n  declarations: [GameComponent, PieceSelectorModal],\n  imports: [\n    CoreModule,\n    RouterModule.forChild(routes),\n  ]\n})\nexport class GameModule { }\n\n","import {Component, OnInit} from '@angular/core';\nimport {NgbActiveModal} from \"@ng-bootstrap/ng-bootstrap\";\n\n@Component({\n  selector: 'jb-piece-selector',\n  templateUrl: './piece-selector.modal.html',\n  styleUrls: ['./piece-selector.modal.scss']\n})\nexport class PieceSelectorModal implements OnInit {\n  public color: 'WHITE' | 'BLACK' = 'WHITE';\n\n  constructor(public activeModal: NgbActiveModal) {}\n\n  ngOnInit(): void {}\n\n  public selectPiece = (piece) => {\n    if (this.color === 'WHITE') {\n      switch (piece) {\n        case 'rook'   : this.activeModal.close(9); break;\n        case 'knight' : this.activeModal.close(10); break;\n        case 'bishop' : this.activeModal.close(11); break;\n        case 'queen'  : this.activeModal.close(12); break;\n      }\n    } else {\n      switch (piece) {\n        case 'rook'   : this.activeModal.close(25); break;\n        case 'knight' : this.activeModal.close(26); break;\n        case 'bishop' : this.activeModal.close(27); break;\n        case 'queen'  : this.activeModal.close(28); break;\n      }\n    }\n  }\n}\n","<jb-modal-header jbTitle=\"view.game.select_piece.header\" (jbClose)=\"activeModal.dismiss()\"></jb-modal-header>\n\n<div class=\"modal-body\">\n\n  <img *ngIf=\"color === 'WHITE'\" src=\"../../../../assets/w-knight.png\" (click)=\"selectPiece('knight')\">\n  <img *ngIf=\"color === 'WHITE'\" src=\"../../../../assets/w-bishop.png\" (click)=\"selectPiece('bishop')\">\n  <img *ngIf=\"color === 'WHITE'\" src=\"../../../../assets/w-rook.png\" (click)=\"selectPiece('rook')\">\n  <img *ngIf=\"color === 'WHITE'\" src=\"../../../../assets/w-queen.png\" (click)=\"selectPiece('queen')\">\n\n  <img *ngIf=\"color === 'BLACK'\" src=\"../../../../assets/b-knight.png\" (click)=\"selectPiece('knight')\">\n  <img *ngIf=\"color === 'BLACK'\" src=\"../../../../assets/b-bishop.png\" (click)=\"selectPiece('bishop')\">\n  <img *ngIf=\"color === 'BLACK'\" src=\"../../../../assets/b-rook.png\" (click)=\"selectPiece('rook')\">\n  <img *ngIf=\"color === 'BLACK'\" src=\"../../../../assets/b-queen.png\" (click)=\"selectPiece('queen')\">\n\n</div>\n\n<!--<div class=\"modal-footer\">-->\n<!--  <jb-btn jbType=\"cancel\" (jbClick)=\"activeModal.dismiss()\"></jb-btn>-->\n<!--</div>-->\n"],"sourceRoot":"webpack:///"}